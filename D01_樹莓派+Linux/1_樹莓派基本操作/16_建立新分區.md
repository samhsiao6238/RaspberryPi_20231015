## 添加並啟用新分區

_在儲存裝置上創建和掛載新的分區_

<br>

## 開始

1. 在現有樹莓派系統上插入燒錄好樹莓派系統的外接裝置。

## 使用 gparted

1. 假如運行 `gparted` 時出現錯誤。

    ```bash
    sudo gparted
    ```

    ![](images/img_137.png)

2. 可先嘗試安裝。

```bash
sudo apt install dosfstools mtools
```

3. 再次運行新增分區並進行格式化。


## 
1. 查看磁碟。
```bash
lsblk
```
_結果_
```bash
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 476.9G  0 disk 
├─sda1   8:1    0   512M  0 part /boot/firmware
└─sda2   8:2    0 476.4G  0 part /
sdb      8:16   1  58.3G  0 disk 
├─sdb1   8:17   1   512M  0 part 
├─sdb2   8:18   1  19.5G  0 part 
└─sdb3   8:19   1  19.5G  0 part 
```

2. 查看所要調整的分區。
```bash
sudo fdisk -l /dev/sdb
```
_結果_
```bash
Disk /dev/sdb: 58.25 GiB, 62545461248 bytes, 122159104 sectors
Disk model: Storage Device  
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x617a2abd

Device     Boot    Start      End  Sectors  Size Id Type
/dev/sdb1           8192  1056767  1048576  512M  c W95 FAT32 (LBA)
/dev/sdb2        1056768 42016767 40960000 19.5G 83 Linux
/dev/sdb3       42016768 82976767 40960000 19.5G 83 Linux
```

## 掛載新分區

1. 查詢當前掛載情況。
```bash
lsblk
```
_結果_
```bash
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 476.9G  0 disk 
├─sda1   8:1    0   512M  0 part /boot/firmware
└─sda2   8:2    0 476.4G  0 part /
sdb      8:16   1  58.3G  0 disk 
├─sdb1   8:17   1   512M  0 part 
├─sdb2   8:18   1  19.5G  0 part 
└─sdb3   8:19   1  19.5G  0 part 
```

2. 查詢已掛載。

```bash
df -h
```
_結果_
```bash
檔案系統        容量  已用  可用 已用% 掛載點
udev            3.8G     0  3.8G    0% /dev
tmpfs           806M  6.0M  800M    1% /run
/dev/sda2       469G  6.8G  444G    2% /
tmpfs           4.0G  352K  4.0G    1% /dev/shm
tmpfs           5.0M   48K  5.0M    1% /run/lock
/dev/sda1       510M   76M  435M   15% /boot/firmware
tmpfs           806M  160K  806M    1% /run/user/1000
```

1. 可建立新的掛載目錄。

    ```bash
    sudo mkdir -p /mnt/sda1 /mnt/sda2 /mnt/sda3
    ```

<br>

4. 將分區掛載到這個目錄。

    ```bash
    sudo mount /dev/sdb1 /mnt/sda1 && sudo mount /dev/sdb2 /mnt/sda2 && sudo mount /dev/sdb3 /mnt/sda3
    ```
    _完成_
    ```bash
    NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
    sda      8:0    0 476.9G  0 disk 
    ├─sda1   8:1    0   512M  0 part /boot/firmware
    └─sda2   8:2    0 476.4G  0 part /
    sdb      8:16   1  58.3G  0 disk 
    ├─sdb1   8:17   1   512M  0 part /mnt/sda1
    ├─sdb2   8:18   1  19.5G  0 part /mnt/sda2
    └─sdb3   8:19   1  19.5G  0 part /mnt/sda3
    ```

<br>

3. 確認新分區已經成功掛載。

    ```bash
    df -h
    ```
    _輸出_
    ```bash
    檔案系統        容量  已用  可用 已用% 掛載點
    udev            3.8G     0  3.8G    0% /dev
    tmpfs           806M  6.0M  800M    1% /run
    /dev/sda2       469G  6.8G  444G    2% /
    tmpfs           4.0G  352K  4.0G    1% /dev/shm
    tmpfs           5.0M   48K  5.0M    1% /run/lock
    /dev/sda1       510M   76M  435M   15% /boot/firmware
    tmpfs           806M  160K  806M    1% /run/user/1000
    /dev/sdb1       510M   75M  436M   15% /mnt/sda1
    /dev/sdb2        20G  4.2G   15G   23% /mnt/sda2
    /dev/sdb3        20G   24K   19G    1% /mnt/sda3
    ```


<br>

## 更新 fstab 文件

1. 使用 blkid 命令來獲取每個分區的UUID。
```bash
sudo blkid
```
_輸出_
```bash
/dev/sda2: LABEL="rootfs" UUID="fc7a1f9e-4967-4f41-a1f5-1b5927e6c5f9" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="08b2d9fd-02"
/dev/sda1: LABEL_FATBOOT="bootfs" LABEL="bootfs" UUID="50C8-AEAE" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="08b2d9fd-01"

/dev/sdb1: LABEL_FATBOOT="bootfs" LABEL="bootfs" UUID="50C8-AEAE" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="617a2abd-01"
/dev/sdb2: LABEL="rootfs" UUID="fc7a1f9e-4967-4f41-a1f5-1b5927e6c5f9" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="617a2abd-02"
/dev/sdb3: UUID="c2722516-dba1-41fc-8fed-c4024b3a1e6b" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="617a2abd-03"
```

2. 若要指定分區可使用 `blkid` 指令查詢。_

    ```bash
    sudo blkid /dev/sda3
    ```

3. 編輯 `fstab` 文件以確保每次啟動時自動掛載分區。

    ```bash
    sudo nano /etc/fstab
    ```

<br>

1. 添加以下行，將新分區自動掛載。

    ```bash
    # UUID=<新分區的UUID>  /mnt/newpart  ext4  defaults  0  2
    PARTUUID=617a2abd-01    /mnt/sda1   vfat    defaults            0   2
    PARTUUID=617a2abd-02    /mnt/sda2   ext4    defaults,noatime    0   1
    PARTUUID=617a2abd-03    /mnt/sda3   ext4    defaults,noatime    0   1
    ```



<br>

3. 保存並退出編輯器，然後重新掛載所有分區以驗證設定。

    ```bash
    sudo mount -a
    ```

<br>

4. 確認新分區已經成功自動掛載。

    ```bash
    df -h
    ```

5. 訪問

