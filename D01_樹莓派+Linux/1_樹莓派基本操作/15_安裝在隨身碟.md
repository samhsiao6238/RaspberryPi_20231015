# 安裝在隨身碟

<br>

## 說明

1. 同樣使用官方燒錄器進行系統燒錄。

<br>

2. 將隨身碟插入樹莓派。

<br>

3. 更新系統。

    ```bash
    sudo apt update -y && sudo apt full-upgrade -y
    ```

<br>

4. 更新 `EEPROM`，僅適用於 `樹莓派 4` 或更新的型號。

    ```bash
    sudo rpi-eeprom-update -a
    ```

<br>

5. 編輯 `EEPROM` 配置文件。

    ```bash
    sudo nano /etc/default/rpi-eeprom-update
    ```

<br>

6. 確保 `BOOT_ORDER` 包含 `USB` 啟動選項。

    ```bash
    FIRMWARE_RELEASE_STATUS="critical"
    ```

<br>

7. 重新啟動樹莓派。

    ```bash
    sudo reboot
    ``` 

<br>

## 修改 SSD

1. 查詢，結果顯示 `/dev/sda` 是外接的 `SSD`。

    ```bash
    lsblk
    ```

    _輸出_

    ```bash
    NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
    sda           8:0    0 476.9G  0 disk 
    ├─sda1        8:1    0   512M  0 part /mnt/usb
    └─sda2        8:2    0     5G  0 part /media/sam6238/rootfs
    mmcblk0     179:0    0  58.3G  0 disk 
    ├─mmcblk0p1 179:1    0   512M  0 part /boot/firmware
    └─mmcblk0p2 179:2    0  57.7G  0 part /
    ```

<br>

2. 確認分區格式，`SSD（/dev/sda）` 上有兩個分區，`/dev/sda1` 是 `FAT32` 格式，用於 `/boot`；`/dev/sda2` 是 `ext4` 格式，用於 `根分區（/）`。

    ```bash
    sudo blkid
    ```

    _輸出_

    ```bash
    /dev/mmcblk0p1: LABEL_FATBOOT="bootfs" LABEL="bootfs" UUID="50C8-AEAE" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="ae60924e-01"
    /dev/mmcblk0p2: LABEL="rootfs" UUID="fc7a1f9e-4967-4f41-a1f5-1b5927e6c5f9" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="ae60924e-02"
    /dev/sda2: LABEL="rootfs" UUID="fc7a1f9e-4967-4f41-a1f5-1b5927e6c5f9" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="617a2abd-02"
    /dev/sda1: LABEL_FATBOOT="bootfs" LABEL="bootfs" UUID="50C8-AEAE" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="617a2abd-01"
    ```

<br>

3. 編輯 `SSD` 的 `/boot 分區` 上的 `cmdline.txt` 文件。

    ```bash
    sudo nano /mnt/usb/boot/cmdline.txt
    ```

<br>

4. 需要將 `根分區` 指向 `SSD` 的 `/dev/sda2`。

    ```bash
    console=serial0,115200 console=tty1 root=PARTUUID=617a2abd-02 rootfstype=ext4 fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles
    ```

<br>

5. 修改 `SSD` 的 `根分區 /dev/sda2` 上的 `/etc/fstab` 文件，設置正確的掛載點。

    ```bash
    sudo nano /media/sam6238/rootfs/etc/fstab
    ```

<br>

6. 將 `/boot` 和 `根分區` 指向 `SSD`。

    ```bash
    proc            /proc           proc    defaults          0       0
    PARTUUID=617a2abd-01  /boot/firmware  vfat    defaults          0       2
    PARTUUID=617a2abd-02  /               ext4    defaults,noatime  0       1
    ```

<br>

## 設置 autoboot.txt 文件

1. 創建並編輯 `autoboot.txt` 文件。

    ```bash
    sudo nano /mnt/usb/autoboot.txt
    ```

<br>

2. 添加以下內容，指定從 `SSD` 的第一分區引導。

    ```bash
    [all]
    boot_partition=1
    ```

<br>

## 設置引導標誌

1. 進入 fdisk。

    ```bash
    sudo fdisk /dev/sda
    ```

<br>

2. 在 `fdisk` 內輸入 `a`，然後選擇分區 `1` 來設置引導標誌，最後輸入 `w` 保存並退出。

<br>

3. 更新 `EEPROM`。

    ```bash
    sudo rpi-eeprom-update -a && sudo reboot
    ```

<br>

## 重新啟動並確認引導

1. 卸載 `SSD 分區`。

    ```bash
    sudo umount /mnt/usb
    sudo umount /media/sam6238/rootfs
    ```

<br>

2. 重啟系統並拔掉 `SD 卡`。

    ```bash
    sudo reboot
    ```

<br>

3. 使用以下命令檢查根分區。

    ```bash
    df -h /
    ```

<br>

## 連線

1. 這張卡片雖然燒錄時有進行設定，但是實測 `SSH`、`VNC` 皆未開啟，且帳號為 `pi`、主機名稱為 `raspiberry`，由於 `SSH` 並未開啟，所以一定要連線螢幕、滑鼠、鍵盤才能完成設定。

<br>

___

_END_