# 建立橋接模式

_要從本機（192.168.1.101）訪問 Kubernetes 集群（容器內部 IP 為 192.168.49.2），而不使用 SSH 端口轉發的方式，可以考慮建立橋接路由_

<br>

## 工作原理

1. 使用橋接網路模式可使 Docker 容器與主機在同一網段內，這樣本機就可以直接訪問 Kubernetes 集群的 IP 地址，而不需要使用 SSH 端口轉發。這樣可以簡化網路配置，使得本機和容器之間的通信更加直接和高效。

<br>

## 建立步驟

_使用橋接網路模式來配置 Docker，使得容器和主機在同一個網段內，這樣本機就可以直接訪問 Kubernetes 集群的 IP 地址_

<br>

1. 停止當前的 Minikube 集群。

    ```bash
    minikube stop && minikube delete
    ```

<br>

2. 配置 Docker 使用橋接網路，編輯 Docker 的 `daemon.json` 文件，如果不存在，則建立它。

    ```bash
    sudo nano /etc/docker/daemon.json
    ```

<br>

3. 選定一個 IP，比如說 `192.168.1.5`，進行測試確認無響應。

    ```bash
    ping 192.168.1.5
    ```

<br>

4. 添加以下內容，這會將 Docker 的預設橋接網路配置為 192.168.1.x 網段的一部分（請根據實際網路配置調整）。

    ```json
    {
      "bip": "192.168.1.5/24"
    }
    ```

<br>

5. 重啟 Docker。

    ```bash
    sudo systemctl restart docker
    ```

<br>

6. 重新啟動 Minikube。

    ```bash
    minikube start --driver=docker
    ```

<br>

7. 在橋接網路模式下，先查詢容器的 ID。

    ```bash
    docker ps
    ```

<br>

8. 使用容器 ID 查詢其 IP 地址。

    ```bash
    docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <container_id>
    ```

<br>

___

_END_
