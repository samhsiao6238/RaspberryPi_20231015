# 吞食蛇

_實作物件導向改寫_

<br>

## 類 Class 及 主程式

1. 場景：GameScreen

2. 蛇：Snake

3. 食物：Food

4. 計分板：Scoreboard

5. 遊戲：Game

6. 主程式： `__main__`

<br>

## 大綱

1. 複製後在主要腳本中貼上 

    ```python
    '''1. 導入必要庫'''

    '''2. 場景：GameScreen'''

    '''3. 蛇：Snake'''

    '''4. 食物：Food'''

    '''5. 計分板：Scoreboard'''

    '''6. 遊戲：Game'''

    '''7. 主程式： `__main__`'''
    ```

<br>

## 開始撰寫

1. 必要庫：用到什麼再寫什麼就好，不用急於一開始寫足。

    ```python
    import turtle
    import time
    import random
    ```

<br>

2. GameScreen：遊戲場景類，將介面相關項目寫在這個類。

    ```python
    class GameScreen:
        # 初始化 turtle.Screen() 物件
        def __init__(self):
            self.screen = turtle.Screen()
            self.screen.title("吞食蛇游戏")
            self.screen.bgcolor("black")
            self.screen.setup(width=600, height=600)
            self.screen.tracer(0)
        # 更新
        def update(self):
            self.screen.update()
        # 監聽
        def listen(self):
            self.screen.listen()
        # 鍵盤
        def onkeypress(self, func, key):
            self.screen.onkeypress(func, key)
        # 主循環
        def mainloop(self):
            self.screen.mainloop()
    ```

<br>

3. Snake：主要角色ㄡ

    ```python
    class Snake:
        # 初始化 turtle.Turtle() 物件
        def __init__(self):
            self.head = turtle.Turtle()
            self.head.speed(0)
            self.head.shape("square")
            self.head.color("white")
            self.head.penup()
            self.head.goto(0, 0)
            self.head.direction = "stop"
            # 是 Snake 類的一個屬性，是個列表，用來儲存和追蹤蛇的各部位
            self.segments = [self.head]

        def move(self):
            for index in range(len(self.segments) - 1, 0, -1):
                x = self.segments[index - 1].xcor()
                y = self.segments[index - 1].ycor()
                self.segments[index].goto(x, y)

            if self.head.direction == "up":
                self.head.sety(self.head.ycor() + 20)
            elif self.head.direction == "down":
                self.head.sety(self.head.ycor() - 20)
            elif self.head.direction == "left":
                self.head.setx(self.head.xcor() - 20)
            elif self.head.direction == "right":
                self.head.setx(self.head.xcor() + 20)

        def go_up(self):
            if self.head.direction != "down":
                self.head.direction = "up"

        def go_down(self):
            if self.head.direction != "up":
                self.head.direction = "down"

        def go_left(self):
            if self.head.direction != "right":
                self.head.direction = "left"

        def go_right(self):
            if self.head.direction != "left":
                self.head.direction = "right"

        def extend(self):
            new_segment = turtle.Turtle()
            new_segment.speed(0)
            new_segment.shape("square")
            new_segment.color("grey")
            new_segment.penup()
            self.segments.append(new_segment)
    ```

<br>

4. Food：食物。

    ```python
    class Food:
        def __init__(self):
            self.food = turtle.Turtle()
            self.food.speed(0)
            self.food.shape("circle")
            self.food.color("red")
            self.food.penup()
            self.food.goto(0, 100)

        def refresh(self):
            x = random.randint(-290, 290)
            y = random.randint(-290, 290)
            self.food.goto(x, y)
    ```

<br>

5. Scoreboard：計分板。

    ```python
    class Scoreboard:
        def __init__(self):
            self.score = 0
            self.display = turtle.Turtle()
            self.display.speed(0)
            self.display.shape("square")
            self.display.color("white")
            self.display.penup()
            self.display.hideturtle()
            self.display.goto(0, 260)
            self.display.write("Score: 0", align="center", font=("Courier", 24, "normal"))

        def update_score(self):
            self.display.clear()
            self.display.write("Score: {}".format(self.score), align="center", font=("Courier", 24, "normal"))

        def reset(self):
            self.score = 0
            self.update_score()
    ```


<br>

6. Game：遊戲物件。

    ```python
    class Game:
        def __init__(self):
            self.screen = GameScreen()
            self.snake = Snake()
            self.food = Food()
            self.scoreboard = Scoreboard()
            self.is_paused = False
            self.delay = 0.1  # 添加 delay 属性
            self.setup_controls()

        def setup_controls(self):
            self.screen.listen()
            self.screen.onkeypress(self.snake.go_up, "w")
            self.screen.onkeypress(self.snake.go_down, "s")
            self.screen.onkeypress(self.snake.go_left, "a")
            self.screen.onkeypress(self.snake.go_right, "d")
            self.screen.onkeypress(self.toggle_pause, "p")

        def toggle_pause(self):
            self.is_paused = not self.is_paused

        def run(self):
            while True:
                self.screen.update()

                if self.is_paused:
                    continue

                self.snake.move()
                self.screen.update()  # 立即更新屏幕

                if self.snake.head.distance(self.food.food) < 20:
                    self.food.refresh()
                    self.snake.extend()
                    self.scoreboard.score += 10
                    self.scoreboard.update_score()

                if abs(self.snake.head.xcor()) > 290 or abs(self.snake.head.ycor()) > 290:
                    time.sleep(1)
                    self.snake.head.goto(0, 0)
                    self.snake.head.direction = "stop"
                    for segment in self.snake.segments[1:]:
                        segment.goto(1000, 1000)
                    self.snake.segments = [self.snake.head]
                    self.scoreboard.reset()

                for segment in self.snake.segments[1:]:
                    if segment.distance(self.snake.head) < 20:
                        time.sleep(1)
                        self.snake.head.goto(0, 0)
                        self.snake.head.direction = "stop"
                        for segment in self.snake.segments[1:]:
                            segment.goto(1000, 1000)
                        self.snake.segments = [self.snake.head]
                        self.scoreboard.reset()

                time.sleep(self.delay)
    ```

<br>

7. 主程式：就是程序中的 `__main__` 。

    ```python
    if __name__ == "__main__":
        game = Game()
        game.run()
    ```

<br>

---

_END_