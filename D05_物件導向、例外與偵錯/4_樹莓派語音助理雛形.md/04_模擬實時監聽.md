# 模擬實時監聽

_這個範例模擬了實時監聽的語音助理，可回覆相同的句子，可用於錄製預設音頻，比如說 `語音助理結束` ，並用於邏輯程序中。_

<br>

## 範例

1. 更新與安裝套件

    ```bash
    sudo apt-get update
    sudo apt-get install portaudio19-dev
    sudo apt-get install mpg321
    pip install pyaudio gtts
    ```

<br>

2. 程式碼

    ```python
    import speech_recognition as sr
    from gtts import gTTS
    import os, sys
    # 初次啟動時的等待
    # import time

    # 在代碼開始就將標準錯誤重導向到/dev/null
    # 注意這並未真實解決問題，之後還是要打開訊息來逐一排除
    # 當前先確保程序可以運行並不受干擾即可
    f = open(os.devnull, 'w')
    sys.stderr = f

    # 初始化語音識別器
    recognizer = sr.Recognizer()

    # 第一次啟動
    # time.sleep(3) #
    os.system("mpg321 start.mp3")

    while True:
        # 設定麥克風為源
        with sr.Microphone() as source:
            print("請說些話！")
            audio = recognizer.listen(source)

        # 使用Google的語音識別進行繁體中文識別
        try:
            print("Google 語音識別你說了：")
            text = recognizer.recognize_google(audio, language='zh-TW')
            print(text)

            # 如果語音輸入是 "結束" 則終止程序
            # if text == "結束" 
            # 或使用更抽象的語意 
            if "結束" in text:
                print("結束語音助手...")
                os.system("mpg321 end.mp3")
                break
            # 問到天氣的時候
            if "天氣如何" in text:
                # 假設的自訂回答
                weather_response = "今天是晴天，温度28度。"
                speech = gTTS(text=weather_response, lang='zh-TW', slow=False)
                speech.save("weather.mp3")
                os.system("mpg321 weather.mp3")
            

            # 將識別到的文字轉換為繁體中文語音
            speech = gTTS(text=text, lang='zh-TW', slow=False)
            speech.save("text.mp3")
            os.system("mpg321 text.mp3")



        except sr.UnknownValueError:
            print("Google 語音識別無法理解音頻")
        except sr.RequestError as e:
            print("無法從Google 語音識別服務請求結果; {0}".format(e))

    # 程式結束
    ```

<br>


## 可拓展方向

1. 開機背景運行。
2. 自訂詞庫。
3. 串接資訊 API。

<br>

---

_END_