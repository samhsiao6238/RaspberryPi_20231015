# 建立鏡像並推送到 Dockerhub

_建立、構建並推送適用於樹莓派架構的簡單 Python Web 應用程序 Docker 映像到 Docker Hub_

<br>

1. 在本地機創建一個新的目錄結構。

    ```bash
    cd ~/Documents && mkdir myapp && cd myapp && touch app.py requirements.txt Dockerfile && tree && code .
    ```

<br>

2. 架構如下。

    ```bash
    myapp/
    ├── app.py
    ├── requirements.txt
    └── Dockerfile
    ```

<br>

## 編寫腳本

1. 編寫應用程式代碼 `app.py`，這是一個簡單的 Flask 應用程式。

    ```python
    from flask import Flask

    app = Flask(__name__)


    @app.route("/")
    def hello_world():
        return "Hello, Raspberry Pi!"


    if __name__ == "__main__":
        app.run(host="0.0.0.0", port=5001)
    ```

<br>

2. 在 `requirements.txt` 文件中，指定 Flask 依賴。

    ```bash
    Flask==2.0.2
    werkzeug==2.0.3
    ```

<br>

3. 建立 Dockerfile，並在文件中編寫 Dockerfile 以構建適用於 ARM 架構的映像。

    ```dockerfile
    FROM python:3.9

    WORKDIR /usr/src/app

    COPY requirements.txt ./
    RUN pip install --no-cache-dir -r requirements.txt

    COPY . .

    CMD ["python", "./app.py"]
    ```

<br>

4. 若要在本地測試腳本，先安裝套件。

    ```bash
    pip install flask
    ```

<br>

5. 並將 port 指定為 `5001`；或是使用其他未被佔用的端口即可。

    ```python
    if __name__ == "__main__":
        app.run(host='0.0.0.0', port=5001)
    ```

<br>

6. 在專案資料夾中運行腳本。

    ```bash
    python app.py
    ```

<br>

## 進行推送

1. 啟動 Docker Desktop，運行以下指令；若出現警告 `WARNING: daemon is not using the default seccomp profile` 可不予理會。

    ```bash
    docker info
    ```

<br>

2. 登入 Docker Hub；注意這裡的 Username 是我的 `sam6238`，記下自己的名稱，在後續步驟會使用到。

    ```bash
    docker login
    ```

    ![](images/img_52.png)

<br>

3. 在 `myapp` 目錄中構建 Docker 映像。

    ```bash
    docker build -t sam6238/myapp-image-arm64:latest .
    ```

<br>

4. 確認成功後，將構建好的映像推送到 Docker Hub；其中 `sam6238` 是我的帳號名稱，務必更換為自己的 Docker Hub 帳戶名稱。

    ```bash
    docker push sam6238/myapp-image-arm64:latest
    ```

    ![](images/img_53.png)

<br>

## 修正鏡像

1. 修正腳本後，先進行重構。

    ```bash
    docker build -t sam6238/myapp-image-arm64 .
    ```

<br>

2. 重新推送。

    ```bash
    docker push sam6238/myapp-image-arm64
    ```

<br>

___

_END_